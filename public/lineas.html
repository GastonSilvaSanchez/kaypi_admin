<!DOCTYPE html>
<html lang="es">
    <head>
	<title>KAYPI-ADMIN</title>
	
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <link href="//maxcdn.bootstrapcdn.com/bootstrap/5.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
		<link rel="stylesheet" href="css/tw.css" />
		<script src="//maxcdn.bootstrapcdn.com/bootstrap/5.0.0/js/bootstrap.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link href="https://fonts.googleapis.com/css2?family=Montserrat&family=Yanone+Kaffeesatz&display=swap" rel="stylesheet">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    </head>
    <body id="page-top">
	
        
		<div class="container register-form">
            <div class="row g-3">
                <div class="note">
                    <p>Añadir Lineas</p>
                </div>
				<div class="row g-3">
					<div class="col-auto">
						<button onclick="goBack()" class="btn btn-primary btn-lg">Atras</button>
					</div>
					<div class="col-auto">
						<form action="/" method="get">
							<input type="submit" name="submit" class="btn btn-primary btn-lg" value="Inicio">
						  </form>
					</div>
                    <div class="col-auto">
                      <form action="/logout" method="get">
                        <input type="submit" name="submit" class="btn btn-danger btn-lg" value="Cerrar Sesion">
                      </form>
                    </div>
                    <div class="col-auto">
						<form action="/listaLineas" method="get">
							<button type="submit" name="submit" class="btn btn-primary btn-lg">Ver Lista</button>
						</form>
                    </div>	
					
					<h2>Paso 1: Agregue la cantidad de calles de la linea</h2>
					<div class="row g-3">

					<label class="text-control" for="cantidadPuntos">Ingrese la cantidad de calles de la linea:</label>
					<input type="number" class="form-control" name="cantidadPunto1" id="cantidadPunto1" min="1" max="500">
					<div class="form-text">El numero debe ser como minimo 1.</div>
					<br>
					<button onclick="GenerarListadeLineas()" id="btnLoadLines" class="btn btn-primary btn-lg">Cargar Campos</button>
				    </div>
					
				</div>	
			<!-- Form-->
			<h2>Paso 2: Llene el siguiente formulario</h2>
			<form action="/guardarLinea" method="post" id="formPrincipal" class="form-content" visibility="hidden"">
				<label class="text-control" for="validationDefault01">Nombre de Linea:</label>
				  <div class="form-group">
					  <input type="text" name="nombre" class="form-control" id="validationDefault01" placeholder="Ingresar Linea + numero o letra de la linea *" value="" required>
					  <div class="form-text">Por ejemplo: Linea Z</div>
					</div>
				<label class="text-control" for="validationDefault02">Categoria:</label>
					<div class="form-group">
					  <input type="text" name="categoria" list="cat" class="form-control" id="validationDefault02" placeholder="Ingresar Categoria Aqui" value="" required>
					  <datalist id="cat">
						<option value="Micro">
						<option value="Minibus">
						<option value="Taxitrufi">
					  </datalist>
					</div>					
				<label class="text-control" for="validationDefault04">Zona:</label>
					<div class="form-group">
					  <input type="text" name="zona" class="form-control" id="validationDefault04" placeholder="Ingresar Zona Aqui" value="" required>
					</div>
					<label class="text-control" for="validationDefault05">Pasajes:</label>
					<div class="form-group">
					  <input type="text" name="pasaje" class="form-control" id="validationDefault05" placeholder="Ingresar Pasaje + Mayores Aqui *" value="" required>
					  <div class="form-text">Por ejemplo: "1.90 Bs. Mayores"</div>
					</div>
					<div class="form-group">
						<input type="text" name="pasaje" class="form-control" id="validationDefault05" placeholder="Ingresar Pasaje + Discapacidad Aqui *" value="" required>
						<div class="form-text">Por ejemplo: "1.50 Bs. Discapacidad"</div>
					</div>
					<div class="form-group">
						<input type="text" name="pasaje" class="form-control" id="validationDefault05" placeholder="Ingresar Pasaje + Universitario Aqui *" value="" required>
						<div class="form-text">Por ejemplo: "0.80 Bs. Universitario"</div>
					</div>
					<div class="form-group">
						<input type="text" name="pasaje" class="form-control" id="validationDefault05" placeholder="Ingresar Pasaje + Estudiantes Aqui *" value="" required>
						<div class="form-text">Por ejemplo: "0.50 Bs. Estudiantes"</div>
					</div>
					<label class="text-control" for="validationDefault06">Calles:</label>
					
					<div id="cantCalles">
					
					</div>
					<div id="cantCallesForm">
					
					</div>
					
					<label class="text-control" for="validationDefault07">Telefonos:</label>
					<div class="row g-3 align-items-center">
						<div class="col-auto">
							<div class="input-group mb-3">
                                <span class="input-group-text" id="tel1">Telefono 1</span>
								<input type="text" name="telefono" class="form-control" id="tel1" placeholder="Ingresar Telefono" required>
                            </div>
						</div>	
			        </div>
					<div class="row g-3 align-items-center">
						<div class="col-auto">
							<div class="input-group mb-3">
                                <span class="input-group-text" id="tel1">Telefono 2</span>
								<input type="text" name="telefono" class="form-control" id="tel1" placeholder="Ingresar Telefono" required>
                            </div>
						</div>	
			        </div>
					<div class="row g-3 align-items-center">
						<div class="col-auto">
							<div class="input-group mb-3">
                                <span class="input-group-text" id="tel1">Telefono 3</span>
								<input type="text" name="telefono" class="form-control" id="tel1" placeholder="Ingresar Telefono">
                            </div>
						</div>	
			        </div>
					<label class="text-control" for="validationDefault08">Horario:</label>
					<div class="form-group">
					  <input type="text" name="horario" class="form-control" id="validationDefault08" placeholder="Ingresar Horario Aqui *" value="" required>
					  <div class="form-text">Por ejemplo: "Diurno: 08:00:00 - 20:00:00"</div>
					  
					</div>
					<br>
					<hr>
					<br>
					<h3>Rutas:</h3>
				   <br>
				   <h3>Ruta Ida</h3>
				   <br>
					<div class="form-group">
						<div class="input-group mb-3">
							<span class="input-group-text" id="sentido">Sentido</span>
							<input type="text" name="ruta1" class="form-control" aria-describedby="sentido" id="validationDefault09" placeholder="Ingresar el sentido ruta de ida aqui" required>
							
						</div>
						<div class="form-text">Añade un sentido de ruta como: NORTE-SUR.</div>
						<br>
						<input type="hidden" name="color1" value="rojo">
						<div id="googleMap1" style="width:100%;height:400px;"></div>
						<div class="form-text">Doble Click Para Agregar un marcador.</div>
						<br>
						<div class="row">
							<div class="col-auto">
								<input id="delete-markers1" type="button" value="Eliminar Lista de Marcadores Para Trazar la Linea con nuevas modificaciones" class="btn btn-danger btn-sm" />
								<div class="form-text">Elimina los puntos y traza una ruta basandote en la linea de la ruta anteriormente ingresada.</div>
							</div>
							<div class="col-auto"></div>
						</div>
						<br>
						
						<div id="cantIda">
					
						</div>
						<div id="cantIda2">
					
						</div>
					</div>
					
					<br>
					<hr>
					<br>
					<h3>Ruta Vuelta</h3>
					<br>
					<div class="form-group">
						<div class="input-group mb-3">
							<span class="input-group-text" id="sentido">Sentido</span>
							<input type="text" name="ruta2" aria-describedby="sentido" class="form-control" id="validationDefault10" placeholder="Ingresar el sentido ruta de vuelta aqui" required>
							
						</div>
						<div class="form-text">Añade un sentido de ruta contrario a la ruta de ida como: SUR-NORTE.</div>
						<br>
						<input type="hidden" name="color2" value="azul">
						<div id="googleMap2" style="width:100%;height:400px;"></div>
						<div class="form-text">Doble Click Para Agregar un marcador.</div>
						<br>
						<div class="row">
							<div class="col-auto">
								<input id="delete-markers2" type="button" value="Eliminar Lista de Marcadores Para Trazar la Linea con nuevas modificaciones" class="btn btn-danger btn-sm" />
								<div class="form-text">Elimina los puntos y traza una ruta basandote en la linea de la ruta anteriormente ingresada.</div>
							</div>
							<div class="col-auto"></div>
						</div>
						<br>
						<br>
						<div id="cantVuelta">
					
						</div>
						<div id="cantVuelta2">
					
						</div>
					</div>
					
					
					<br />
				<input class="btnSubmit" type="submit" value="Registrar" >
			</form>
        </div>
    </body>
	
	<script>
	// Cambia el estado de los inputs a deshabilitado cuando carga la pagina
	window.onload = function(e) {
		var form  = document.getElementById("formPrincipal");
        var allElements = form.elements;
        for (var i = 0, l = allElements.length; i < l; ++i) {
         // allElements[i].readOnly = true;
         allElements[i].disabled=true;
        }
    }
	//Genera una lista de lineas dependiendo la cantidad que se dio al principio de ida y de vuelta
	function GenerarListadeLineas() {
		var btn = document.getElementById('btnLoadLines');
		inputIda = document.getElementById('cantidadPunto1');
        var cantIda = document.getElementById('cantidadPunto1').value;
		inputIda.disabled=true;
		btn.disabled=true;
		if(cantIda < 1){
			alert("El numero para la cantidad de las las calles debe ser mayor a 0");
			inputIda.disabled=false;
		    btn.disabled=false;
		}
		else{
			HabilitarForm();
		document.querySelector('#cantCalles').innerHTML += `
		<input type="hidden" name="cantCalles" value="${cantIda}">
		
		`;
		for (let index = 1; index <= cantIda; index++) {
			document.querySelector('#cantCallesForm').innerHTML += `
			<div class="row g-3 align-items-center">
						<div class="col-auto">
							<div class="input-group mb-3">
                                <span class="input-group-text" id="calle">Calle ${index}</span>
								<input type="text" name="calle" class="form-control" id="calle" placeholder="Ingresar Calle Numero ${index}" required>
                            </div>
				
						</div>
			</div>
		`			
		}
		
		}
		removeMarkers1();
		removeMarkers2();
		
		
	} 
	//Cambiar el estado a habilitado de todos los inputs de el form con el id formPrincipal
	function HabilitarForm() {
		var form  = document.getElementById("formPrincipal");
        var allElements = form.elements;
        for (var i = 0, l = allElements.length; i < l; ++i) {
         // allElements[i].readOnly = true;
         allElements[i].disabled=false;
        }
    }
	//Ir una ventana atras del historial
	function goBack() {
       window.history.back();
     }

	var form = document.getElementById("formPrincipal");
	//Cuando se de click al submit se presentara la siguiente operacion de validaciones para los campos text que requieran ser numericos
    form.onsubmit = function() {
		var telefono = document.getElementById("tel1").value;
	var status = true;
			if(typeof telefono == 'number' && telefono.length<7 ||telefono.length>14){
			   alert("El telefono esta fuera del rango de caracteres establecido 7-14");
			   return false;
		    }
			if(isNaN(telefono)){
				alert("El campo de telefono debe contener solo caractes numericos");
				return false;

			}
    }   

	
	</script>
	<script>
	let map1,map2;
    var count=0;
	var markers1=[];
	var markers2=[];
    function initMap() {
		const cochabamba ={lat: -17.387783, lng: -66.155871}
        map1 = new google.maps.Map(document.getElementById("googleMap1"), {
        center: cochabamba,
		disableDoubleClickZoom: true,
		streetViewControl: false,
        zoom: 13,  
      });
        map2 = new google.maps.Map(document.getElementById("googleMap2"), {
        center: cochabamba,
		disableDoubleClickZoom: true,
		streetViewControl: false,
        zoom: 13,
      });
      google.maps.event.addListener(map1, "dblclick", (event) => {
		document.querySelector('#cantIda2').innerHTML = ``;
			addMarker1(event.latLng, map1);
			var myLatLng = event.latLng;
			var lat = myLatLng.lat();
            var lng = myLatLng.lng();
			document.querySelector('#cantIda').innerHTML += `
			<div class="row g-3 align-items-center">
						<div class="col-auto">
							<div class="input-group mb-3">
                                <span class="input-group-text" id="lat1">Latitud</span>
								<input type="text" name="lat1" class="form-control" id="lat1" value="${lat}"  required>
                            </div>
						</div>
						<div class="col-auto">
							<div class="input-group mb-3">
                                <span class="input-group-text" id="lng1">Longitud</span>
								<input type="text" name="lng1" class="form-control" id="lng1" value="${lng}"  required>
                            </div>
						</div>		
			</div>
		`;			
			
      });
	  google.maps.event.addListener(map2, "dblclick", (event) => {
		document.querySelector('#cantVuelta2').innerHTML = ``;
			addMarker2(event.latLng, map2);
			var myLatLng = event.latLng;
            var lat = myLatLng.lat();
            var lng = myLatLng.lng();
			document.querySelector('#cantVuelta').innerHTML += `
			<div class="row g-3 align-items-center">
						<div class="col-auto">
							<div class="input-group mb-3">
                                <span class="input-group-text" id="lat2">Latitud</span>
								<input type="text" name="lat2" class="form-control" id="lat2" value="${lat}"  required>
                            </div>
						</div>
						<div class="col-auto">
							<div class="input-group mb-3">
                                <span class="input-group-text" id="lng2">Longitud</span>
								<input type="text" name="lng2" class="form-control" id="lng2" value="${lng}"  required>
                            </div>
						</div>		
			</div>
		`;				
			
         
			count++;
      });
    }
	function addMarker1(location, map) {
        var marker1 = new google.maps.Marker({
        position: location,
        map: map
     });
	 marker1.addListener("dblclick", function() {
     marker1.setMap(null);
     });
    markers1.push(marker1);
    }
	 function addMarker2(location, map) {
        var marker2 = new google.maps.Marker({
        position: location,
        map: map
     });

     marker2.addListener("dblclick", function() {
     marker2.setMap(null);
     });
    markers2.push(marker2);
    }
	function setMapOnAll1(map) {
    for (var i = 0; i < markers.length; i++) {
    markers1[i].setMap(map1);
    }
    }    

    function clearMarkers1() {
    setMapOnAll1(null);

    }

    function showMarkers1() {
    setMapOnAll1(map1);
    }
    function deleteMarkers1() {
    clearMarkers1();
    markers1 = [];
    }
	function setMapOnAll2(map) {
    for (var i = 0; i < markers.length; i++) {
    markers1[i].setMap(map2);
    }
    }    

    function clearMarkers2() {
    setMapOnAll1(null);

    }

    function showMarkers2() {
    setMapOnAll1(map2);
    }
    function deleteMarkers2() {
    clearMarkers2();
    markers2 = [];
    }
	function removeMarkers1(){
	document.querySelector('#cantIda').innerHTML = ``;
	document.querySelector('#cantIda2').innerHTML += `
					<div class="row g-3 align-items-center">
								<div class="col-auto">
									<div class="input-group mb-3">
										<span class="input-group-text">Latitud</span>
										<input type="text" class="form-control" name="lat1" id="lat1" placeholder="Ingrese la latitud" aria-label="Latitud" aria-describedby="lat" required>
									</div>
						
								</div>
								<div class="col-auto">
									<div class="input-group mb-3">
										<span class="input-group-text">Longitud</span>
										<input type="text" class="form-control" id="lng1" name="lng1" placeholder="Ingrese la longitud" aria-label="Longitud" aria-describedby="lng" required>
									</div>
								</div>
								<div class="col-auto">
									<div class="card" style="width: 38rem;">
                                      <img class="card-img" src="./img/routeGuide01.gif" alt="Card image cap">
                                    </div>
									<div class="card-footer">
										<small class="text-primary">Llene el mapa con puntos basandose en este ejemplo</small>
                                    </div>
								</div>
					</div>
					<div class="form-text text-danger">Se requiere tener puntos marcados en el mapa</div>
				`;			
	
    for(i=0; i<markers1.length; i++){
        markers1[i].setMap(null);
    }
	markers1 = [];
    }
	function removeMarkers2(){
	document.querySelector('#cantVuelta').innerHTML = ``;
	document.querySelector('#cantVuelta2').innerHTML += `
					<div class="row g-3 align-items-center">
								<div class="col-auto">
									<div class="input-group mb-3">
										<span class="input-group-text">Latitud</span>
										<input type="text" class="form-control" name="lat2" id="lat2" placeholder="Ingrese la latitud" aria-label="Latitud" aria-describedby="lat" required>
									</div>
						
								</div>
								<div class="col-auto">
									<div class="input-group mb-3">
										<span class="input-group-text">Longitud</span>
										<input type="text" class="form-control" id="lng2" name="lng2" placeholder="Ingrese la longitud" aria-label="Longitud" aria-describedby="lng" required>
									</div>
								</div>
								<div class="col-auto">
									<div class="card" style="width: 38rem;">
                                      <img class="card-img" src="./img/routeGuide01.gif" alt="Card image cap">
                                    </div>
									<div class="card-footer">
									  <small class="text-primary">Llene el mapa con puntos basandose en este ejemplo</small>
                                    </div>
								</div>
					</div>
					<div class="form-text text-danger">Se requiere tener puntos marcados en el mapa</div>
					
				`;			
	
    for(i=0; i<markers2.length; i++){
        markers2[i].setMap(null);
    }
	markers2 = [];
    }

	document.getElementById("delete-markers1").addEventListener("click", removeMarkers1);
	document.getElementById("delete-markers2").addEventListener("click", removeMarkers2);
		</script>
		 <script
		 src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBY0Y6-0YKuzrsaoPmY4SjJAx93J6yeJb8&callback=initMap&v=weekly"
		 async
	   ></script>
</html>
